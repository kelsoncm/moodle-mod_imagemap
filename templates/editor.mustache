{{#has_image}}
<div class="imagemap-editor-container">
    <div class="area-controls imagemap-toolbar">
        <div class="btn-group btn-group-toggle" role="group" aria-label="Tools">
            <button type="button" class="btn btn-outline-secondary toolbar-btn active" data-tool="hand" title="{{tool_hand}}">
                <svg width="18" height="18" viewBox="0 0 18 18"><path d="M4 9V6.5a1.5 1.5 0 0 1 3 0V4.5a1.5 1.5 0 0 1 3 0V3.5a1.5 1.5 0 0 1 3 0v3a1.5 1.5 0 0 1 3 0v4c0 3.5-2.5 5.5-6 5.5S4 14 4 11.5z" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
            <button type="button" class="btn btn-outline-primary toolbar-btn" data-tool="rect" title="{{shape_rect}}">
                <svg width="18" height="18" viewBox="0 0 18 18"><rect x="2" y="3" width="14" height="12" fill="none" stroke="currentColor" stroke-width="2"/></svg>
            </button>
            <button type="button" class="btn btn-outline-primary toolbar-btn" data-tool="circle" title="{{shape_circle}}">
                <svg width="18" height="18" viewBox="0 0 18 18"><circle cx="9" cy="9" r="7" fill="none" stroke="currentColor" stroke-width="2"/></svg>
            </button>
            <button type="button" class="btn btn-outline-primary toolbar-btn" data-tool="poly" title="{{shape_poly}}">
                <svg width="18" height="18" viewBox="0 0 18 18"><polygon points="9,1 17,7 14,17 4,17 1,7" fill="none" stroke="currentColor" stroke-width="2"/></svg>
            </button>
            <button type="button" class="btn btn-outline-info toolbar-btn" data-tool="line" title="{{tool_line}}">
                <svg width="18" height="18" viewBox="0 0 18 18"><line x1="3" y1="15" x2="15" y2="3" stroke="currentColor" stroke-width="2"/><circle cx="3" cy="15" r="2" fill="currentColor"/><circle cx="15" cy="3" r="2" fill="currentColor"/></svg>
            </button>
            <button type="button" class="btn btn-outline-danger toolbar-btn" data-tool="eraser" title="{{tool_eraser}}">
                <svg width="18" height="18" viewBox="0 0 18 18"><path d="M5 16h8M3 12l8-8 4 4-6 8H5l-2-4z" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
        </div>
        <button id="finish-poly" class="btn btn-primary btn-sm" style="display: none; margin-left: 8px;">{{finish}}</button>
        <div class="toolbar-status" id="toolbar-status"></div>
    </div>
    
    <div class="imagemap-canvas-wrapper">
        <canvas id="imagemap-canvas"></canvas>
    </div>
    <div class="imagemap-overlay" id="imagemap-overlay"></div>

    <div id="area-form-container" style="display: none;">
        <h4 id="area-form-title">{{addarea}}</h4>
        <form id="area-form" method="post" action="{{area_save_url}}">
            <input type="hidden" name="sesskey" value="{{sesskey}}">
            <input type="hidden" name="cmid" value="{{cmid}}">
            <input type="hidden" name="imagemapid" value="{{imagemapid}}">
            <input type="hidden" name="areaid" id="form-areaid" value="">
            <input type="hidden" name="shape" id="form-shape" value="">
            <input type="hidden" name="coords" id="form-coords" value="">
            <input type="hidden" name="targettype" id="form-targettype" value="">
            <input type="hidden" name="targetid" id="form-targetid" value="">
            
            <div class="form-group">
                <label for="title">{{title_label}}:</label>
                <input type="text" class="form-control" id="title" name="title" required>
                <small class="form-text text-muted">{{title_help}}</small>
            </div>
            
            <div class="form-group">
                <label for="target-select">{{target_label}}:</label>
                <select class="form-control" id="target-select" required>
                    {{#target_options}}
                    <option value="{{value}}">{{label}}</option>
                    {{/target_options}}
                </select>
                <small class="form-text text-muted">{{target_help}}</small>
            </div>
            
            <!-- CSS Filters Preview Row -->
            <div class="row mb-3">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-body text-center p-2">
                            <small class="d-block mb-2"><strong>{{activefilter_label}}</strong></small>
                            <canvas class="css-preview-canvas" id="activefilter-preview-canvas" width="190" height="80"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-body text-center p-2">
                            <small class="d-block mb-2"><strong>{{inactivefilter_label}}</strong></small>
                            <canvas class="css-preview-canvas" id="inactivefilter-preview-canvas" width="190" height="80"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <label for="activefilter" class="m-0">{{activefilter_label}}:</label>
                    <button type="button" class="btn btn-sm btn-outline-primary open-css-examples-btn" data-filter-type="active" data-target-field="activefilter">
                        {{#str}}viewexamples, imagemap{{/str}}
                    </button>
                </div>
                <textarea class="form-control css-input" id="activefilter" name="activefilter" rows="2" style="overflow: hidden; resize: vertical;" placeholder="filter: brightness(1.2); ou border: 3px solid #00ff00;">none</textarea>
                <small class="form-text text-muted">{{{activefilter_help}}}</small>
            </div>
            
            <div class="form-group">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <label for="inactivefilter" class="m-0">{{inactivefilter_label}}:</label>
                    <button type="button" class="btn btn-sm btn-outline-primary open-css-examples-btn" data-filter-type="inactive" data-target-field="inactivefilter">
                        {{#str}}viewexamples, imagemap{{/str}}
                    </button>
                </div>
                <textarea class="form-control css-input" id="inactivefilter" name="inactivefilter" rows="2" style="overflow: hidden; resize: vertical;" placeholder="filter: grayscale(1); ou background: rgba(0,0,0,0.6);">grayscale(1) opacity(0.5)</textarea>
                <small class="form-text text-muted">{{{inactivefilter_help}}}</small>
            </div>
            
            <button type="submit" class="btn btn-primary">{{savechanges}}</button>
            <button type="button" class="btn btn-secondary" id="close-area-form">
                {{cancel}}
            </button>
        </form>
    </div>
</div>

<div class="area-list">
    <h4>{{managereas}}</h4>
    {{#has_areas}}
    <table class="table">
        <thead>
            <tr>
                <th>{{title_label}}</th>
                <th>{{shape_label}}</th>
                <th>{{target_label}}</th>
                <th>{{connections_label}}</th>
                <th>{{actions}}</th>
            </tr>
        </thead>
        <tbody>
            {{#areas}}
            <tr>
                <td>{{title}}</td>
                <td>{{shape}}</td>
                <td>{{target_label}}</td>
                <td>{{lines_count}}</td>
                <td>
                    <a href="{{delete_url}}"
                       class="btn btn-sm btn-danger"
                       onclick="return confirm('{{confirmdeletearea}}');">
                        {{delete}}
                    </a>
                </td>
            </tr>
            {{/areas}}
        </tbody>
    </table>
    {{/has_areas}}
    {{^has_areas}}
    <p>{{noareas}}</p>
    {{/has_areas}}
</div>

{{else}}
<div class="alert alert-warning">{{error_noimage}}</div>
{{/has_image}}

<!-- CSS Examples Modal -->
{{{css_examples_modal}}}
